(function(c,b){if(c.mask){return}function a(d){this.config=this._extend(d,a.config,false);if(!this.config.target){return false}this._init()}a.config={target:false,fillStyle:"color",fillContent:"#cccccc",percent:"100",radius:"15",touchstart:function(){},touchmove:function(){},touchend:function(){},complete:function(){},inited:function(){}};a.prototype={_init:function(){var s=this;var o=s.config;var e=o.target;var t=e.getContext("2d");var r=e.clientWidth;var l=e.clientHeight;var d=false;e.width=r;e.height=l;e.style.backgroundColor="#ffffff";if(o.fillStyle=="color"){t.fillStyle=o.fillContent;t.fillRect(0,0,r,l);t.globalCompositeOperation="destination-out";e.style.backgroundColor="transparent";o.inited&&o.inited()}else{if(o.fillStyle=="image"){q(o.fillContent,function(){t.drawImage(this,0,0,r,l);t.globalCompositeOperation="destination-out";e.style.backgroundColor="transparent";o.inited&&o.inited()})}else{return false}}var p="ontouchstart" in c?true:false;var f=p?"touchstart":"mousedown";var i=p?"touchmove":"mousemove";var g=p?"touchend":"mouseup";e.addEventListener(f,j);e.addEventListener(g,k);e.addEventListener(i,m);function q(u,v){var h=new Image();h.src=u;if(h.complete){v.call(h);return}h.onload=function(){v.call(h)}}function j(h){h.preventDefault();if(h.changedTouches){h=h.changedTouches[h.changedTouches.length-1]}d=true;o.touchstart&&o.touchstart(h)}var n=0;function k(y){y.preventDefault();if(y.changedTouches){y=y.changedTouches[y.changedTouches.length-1]}d=false;o.touchend&&o.touchend(y);try{var x=t.getImageData(0,0,r,l).data;var w=0;for(var h=0;h<x.length;h+=4){if(x[h+3]==0){w++}}var v=parseInt(o.percent?o.percent:100)/100;if(w>=r*l*v){e.style.webkitTransitionDuration="500ms";e.style.MozTransitionDuration="500ms";e.style.msTransitionDuration="500ms";e.style.OTransitionDuration="500ms";e.style.transitionDuration="500ms";e.style.opacity=0;setTimeout(function(){t.clearRect(0,0,r,l);e.style.webkitTransitionDuration="0ms";e.style.MozTransitionDuration="0ms";e.style.msTransitionDuration="0ms";e.style.OTransitionDuration="0ms";e.style.transitionDuration="0ms";e.style.opacity=1},500);o.complete&&o.complete()}}catch(u){var v=parseInt(o.percent?o.percent:100)/10;console.log("所引用图片地址不属于本域名 canvas中getImageData方法不支持跨域 改为刮了"+v+"次之后自动抹去");n++;if(n>v){e.style.webkitTransitionDuration="500ms";e.style.MozTransitionDuration="500ms";e.style.msTransitionDuration="500ms";e.style.OTransitionDuration="500ms";e.style.transitionDuration="500ms";e.style.opacity=0;setTimeout(function(){t.clearRect(0,0,r,l);e.style.webkitTransitionDuration="0ms";e.style.MozTransitionDuration="0ms";e.style.msTransitionDuration="0ms";e.style.OTransitionDuration="0ms";e.style.transitionDuration="0ms";e.style.opacity=1},500);o.complete&&o.complete()}}}function m(v){v.preventDefault();if(d){if(v.changedTouches){v=v.changedTouches[v.changedTouches.length-1]}var u=e.getBoundingClientRect().left;var z=e.getBoundingClientRect().top;var h=v.clientX-u;var w=v.clientY-z;t.beginPath();t.arc(h,w,o.radius,0,Math.PI*2);t.fill();o.touchmove&&o.touchmove(v)}}},_extend:function(d,h,f,e){if(f===undefined){f=true}for(var g in h){if(f||!(g in d)){if(e){e(g)}else{d[g]=h[g]}}}return d}};c.mask=a})(window,document);